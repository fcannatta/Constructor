# ============================================
# CONFIGURAÇÃO GLOBAL DO SISTEMA DE BUILD
# ============================================

# Diretório raiz do sistema
ROOT_DIR="/opt/buildsystem"

# Estrutura principal de diretórios
SRC_DIR="$ROOT_DIR/sources"          # Fontes originais (.tar, .zip, etc)
PKG_REPO_LOCAL="$ROOT_DIR/package"   # Diretório onde ficam os .desc
BUILD_DIR="$ROOT_DIR/build"          # Diretórios temporários de compilação
OUTPUT_DIR="$ROOT_DIR/output"        # Pacotes prontos (.tar.xz)
LOG_DIR="$ROOT_DIR/logs"             # Logs gerais
DB_DIR="$ROOT_DIR/db"                # Banco de pacotes instalados
HOOKS_DIR="$ROOT_DIR/hooks"          # Hooks pré/pós build
TOOLCHAIN_DIR="$ROOT_DIR/toolchain"  # Toolchain local (bootstrap)
STATUS_DIR="$ROOT_DIR/status"        # Status e relatórios
GRAPHS_DIR="$ROOT_DIR/graphs"        # Mapas e grafos de dependências
TMP_DIR="/tmp/buildsystem"           # Fallback temporário

# Repositórios Git
PKG_REPO_GIT="https://github.com/SEU_USUARIO/seu-repo-pacotes.git"
PKG_REPO_BRANCH="main"
BIN_REPO_GIT="https://github.com/SEU_USUARIO/seu-repo-binarios.git"
BIN_REPO_BRANCH="main"
AUTO_SYNC_PKG_REPO="yes"
AUTO_SYNC_BIN_REPO="no"

# Ambiente e arquitetura
ARCH="x86_64"
JOBS="$(nproc)"
LANG="C"
LC_ALL="C"

# Flags de compilação
CFLAGS="-O2 -pipe -fPIC"
CXXFLAGS="-O2 -pipe -fPIC"
LDFLAGS="-Wl,-O1 -Wl,--as-needed"
MAKEFLAGS="-j${JOBS}"

# Comportamento geral
SILENT_MODE="no"           # yes = menos saída no terminal
CONTINUE_ON_FAIL="no"      # Interrompe em erro crítico
CLEAN_BEFORE_BUILD="no"
SAVE_LOGS="yes"
RETRY_COUNT=3
AUTO_RETRY="yes"

# Fontes alternativas e mirrors
MIRRORS=(
  "https://ftp.gnu.org/gnu"
  "https://ftp.mozilla.org/pub"
  "https://download.kde.org/stable"
  "https://github.com"
)
TIMEOUT=30
MAX_FETCH_JOBS=4           # Número máximo de downloads simultâneos

# Políticas de atualização
UPDATE_POLICY="major_only"
ALLOW_BETA="no"
AUTO_BACKUP_DESC="yes"
ROLLBACK_ENABLED="yes"

# Dependências
PKG_LIST="$ROOT_DIR/package-list.txt"
DEPSOLVE_MODE="strict"
ALLOW_OPTIONAL_DEPS="yes"
ENABLE_OPTIONAL_GNOME="yes"
ENABLE_OPTIONAL_KDE="no"
ENABLE_OPTIONAL_PULSEAUDIO="yes"

# Ferramentas obrigatórias
REQUIRED_TOOLS=(
  gcc make bash tar xz curl git sha256sum gpg
)

# Segurança e assinaturas
VERIFY_SIGNATURES="yes"
GPG_KEYRING="$ROOT_DIR/keys/pubring.gpg"

# Logs e relatórios
MASTER_LOG="$LOG_DIR/build-master.log"
SUMMARY_JSON="$LOG_DIR/build-summary.json"
LOG_FORMAT="text"
REPORT_FORMAT="text"
REPORT_PATH="$LOG_DIR/final-report.txt"

# Hooks
ENABLE_HOOKS="yes"
HOOKS_PRE_BUILD="$HOOKS_DIR/pre-build"
HOOKS_POST_INSTALL="$HOOKS_DIR/post-install"
HOOKS_POST_UPDATE="$HOOKS_DIR/post-update"

# Variáveis derivadas
DATE_NOW="$(date +%Y-%m-%d_%H-%M)"
HOSTNAME="$(hostname)"
